<div class="metodos-pago-container">
  <div class="page-header">
    <div class="header-content">
      <h1><i class="bi bi-credit-card"></i> Gestión de Métodos de Pago</h1>
      <p class="text-muted">Administra los métodos de pago disponibles para las ventas</p>
    </div>
    <div class="header-actions">
      <button 
        class="btn btn-primary"
        (click)="nuevo()">
        <i class="bi bi-plus-circle"></i> Nuevo Método
      </button>
    </div>
  </div>

  <div class="alert alert-danger" *ngIf="error">
    <i class="bi bi-exclamation-triangle"></i> {{ error }}
  </div>

  <div class="alert alert-success" *ngIf="mensaje">
    <i class="bi bi-check-circle"></i> {{ mensaje }}
  </div>

  <div class="card">
    <div class="card-body">
      <app-data-table
        [columns]="tableColumns"
        [data]="metodosPago"
        [actions]="tableActions"
        [loading]="loading"
        [paginated]="true"
        [pageSize]="pageSize"
        [totalRecords]="totalRecords"
        [currentPage]="currentPage"
        (pageChange)="onPageChange($event)"
      ></app-data-table>
    </div>
  </div>
</div>

<!-- Modal para crear/editar método de pago -->
<app-modal 
  #formModal
  [title]="metodoEditando ? 'Editar Método de Pago' : 'Nuevo Método de Pago'"
  size="lg"
  confirmText="Guardar"
  [loading]="guardando"
  (confirm)="guardar()"
  (cancel)="formModal.closeModal()">
  <div class="modal-body-content">
    <form [formGroup]="formulario" (ngSubmit)="guardar()">
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">
            Nombre <span class="text-danger">*</span>
          </label>
          <input 
            type="text" 
            class="form-control" 
            formControlName="nombre"
            [class.is-invalid]="formulario.get('nombre')?.invalid && formulario.get('nombre')?.touched"
            placeholder="Ej: Efectivo"
          />
          <div class="invalid-feedback" *ngIf="formulario.get('nombre')?.invalid && formulario.get('nombre')?.touched">
            El nombre es obligatorio
          </div>
        </div>

        <div class="col-md-6">
          <label class="form-label">
            Código <span class="text-danger">*</span>
          </label>
          <input 
            type="text" 
            class="form-control" 
            formControlName="codigo"
            [class.is-invalid]="formulario.get('codigo')?.invalid && formulario.get('codigo')?.touched"
            placeholder="Ej: EFECTIVO"
          />
          <div class="invalid-feedback" *ngIf="formulario.get('codigo')?.invalid && formulario.get('codigo')?.touched">
            El código es obligatorio
          </div>
        </div>

        <div class="col-md-12">
          <label class="form-label">Descripción</label>
          <textarea 
            class="form-control" 
            formControlName="descripcion"
            rows="3"
            placeholder="Descripción del método de pago"
          ></textarea>
        </div>

        <div class="col-md-6">
          <label class="form-label">
            Tipo de Método <span class="text-danger">*</span>
          </label>
          <select 
            class="form-select" 
            formControlName="tipoMetodo"
            [class.is-invalid]="formulario.get('tipoMetodo')?.invalid && formulario.get('tipoMetodo')?.touched"
          >
            <option *ngFor="let tipo of tiposMetodoPago" [value]="tipo">
              {{ getTipoMetodoLabel(tipo) }}
            </option>
          </select>
          <div class="invalid-feedback" *ngIf="formulario.get('tipoMetodo')?.invalid && formulario.get('tipoMetodo')?.touched">
            El tipo de método es obligatorio
          </div>
        </div>

        <div class="col-md-6">
          <label class="form-label">Orden</label>
          <input 
            type="number" 
            class="form-control" 
            formControlName="orden"
            min="0"
            placeholder="0"
          />
          <small class="form-text text-muted">Orden de visualización en el punto de venta</small>
        </div>

        <div class="col-md-6">
          <label class="form-label">Icono</label>
          <input 
            type="text" 
            class="form-control" 
            formControlName="icono"
            placeholder="Ej: bi-cash-coin"
          />
          <small class="form-text text-muted">Nombre del icono de Bootstrap Icons</small>
        </div>

        <div class="col-md-6">
          <div class="form-check mt-4">
            <input 
              class="form-check-input" 
              type="checkbox" 
              formControlName="esElectronico"
              id="esElectronico"
            />
            <label class="form-check-label" for="esElectronico">
              Es Electrónico
            </label>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-check">
            <input 
              class="form-check-input" 
              type="checkbox" 
              formControlName="requiereReferencia"
              id="requiereReferencia"
            />
            <label class="form-check-label" for="requiereReferencia">
              Requiere Referencia
            </label>
            <small class="form-text text-muted d-block">Si requiere número de operación o referencia</small>
          </div>
        </div>
      </div>
    </form>
  </div>
</app-modal>
